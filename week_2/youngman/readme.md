Browser 동작
브라우저는 아마도 가장많이 사용하는 소프트웨어일 것이다. 이 글을 통해 브라우저가 어떻게 동작하는지 설명한다. browser 주소창에 url을 입력했을 때 어떤 과정을 거쳐 화면에 표시되는 지 알게 될 것이다.

브라우저의 종류 - 최근 인터넷 익스플로러, 파이어폭스, 사파리, 크롬, 오페라 5개의 브라우저를 많이 사용한다. 필자는 주로 크롬, 사파리를 이용하며 테스트를 위해 오페라와 파이어폭스를 가끔 사용한다. 

브라우저의 기능 - 브라우저의 주요 기능은 사용자가 선택한 자원을 서버에 요청하고 브라우저에 표시하는 것이다. 자원은 보통 HTML 문서지만 PDF나 이미지 또는 다른 형태일 수 있다. 자원의 주소는 URI(Uniform Resource Identifier)에 의해 정해진다.

브라우저는 HTML과 CSS 명세에 따라 HTML 파일을 해석해서 표시하는데 이 명세는 웹 표준화 기구인 W3C( World Wide Web Consortium)에서 정한다. 과거에는 브라우저들이 일부만 이 명세에 따라 구현하고 독자적인 방법을 확장함으로써 웹 제작자가 심각한 호환성 문제를 겪었지만 최근에는 대부분의 브라우저가 표준 명세를 따른다.

브라우저의 사용자 인터페이스는 서로 닮아 있는데 다음과 같은 요소들이 일반적
* URI을 입력할 수 있는 주소 표시줄
* 이전 버튼과 다음 버튼
* 북마크
* 새로 고침 버튼과 현재 문서의 로드를 중단할 수 있는 정지 버튼
* 홈 버튼

브라우저의 주요 구성 요소는 다음과 같다.
1. 사용자 인터페이스 - 주소 표시줄, 이전/다음 버튼, 북마크 메뉴 등. 요청한 페이지를 부여주는 창을 제외한 나머지 모든 부분
2. 브라우저 엔진 - 사용자 인터페이스와 렌더링 엔진 사이의 동작을 제어.
3. 렌더링 엔진 - 요청한 콘텐츠를 표시. 예를 들어 HTML을 요청하면 HTML과 CSS를 파싱하여 화면에 표시함. 
4. 통신 - HTTP 요청과 같은 네트워크 호출에 사용됨. 이것은 플랫폼 독립적인 인터페이스이고 각 플랫폼 하부에서 실행됨.
5. UI 백엔드 - 콤보 박스와 창 같은 기본적인 장치를 그림. 플랫폼에서 명시하지 않은 일반적인 인터페이스로서, OS 사용자 인터페이스 체계를 사용.
6. 자바스크립트 해석기 - 자바스크립트 코트를 해석하고 실행.
7. 자료 저장소 - 이 부분은 자료를 저장하는 계층. 쿠키를 저장하는 것과 같인 모든 종류의 자원을 하드 디스크에 저장할 필요가 있다. HTML5 명세에는 브라우저가 지원하는 웹 데이터 베이스가 정의 되어있다.

크롬은 대부분의 브라우저와 달리 각 탭마다 별도의 렌더링 엔진 인스턴스를 유지하는 것이 주목할만하다. 각 탭은 독립된 프로세스로 처리된다.

렌더링 엔진
렌더링 엔진의 역할은 요청 받은 내용을 브라우저 화면에 표시하는 일이다.
HTML및  XML 문서와 이미지를 표시할 수 있다. 물론 플러그인이나 브라우저 확장 기능을 이용해 PDF와 같은 다른 유형도 표시할 수 있다.

렌더링 엔진들
파이어폭스, 크롬, 사파리는 두 종류의 렌더링 엔진으로 제작되었다. 파이어폭스는 모질라에서 직접 만듬 게코(Gecko)엔진을 사용하고 사파리와 크롬은 웹킷(Webkit) 엔진을 사용한다.(최근에 크롬은 Blink기반 엔진으로 변경)

웹킷은 최초 리눅스 플랫폼에서 동작하기 위해 제작된 오픈소스 엔진인데 애플이 맥과 윈도우즈에서 사파리 브라우저를 지원하기 위해 수정을 가했다.

동작 과정
렌더링 엔진은 통신으로부터 요청한 문서의 내용을 얻는 것으로 시작하는데 문서의 내용은 보통 8KB 단위로 전송된다.

![image](https://user-images.githubusercontent.com/30422982/40397515-234d20fe-5e6e-11e8-9d67-16579dac75c0.png)

렌더링 엔진은 HTML 문서를 파싱하고 “콘텐츠 트리” 내부에서 태그를 DOM 노드로 변환한다. 그 다음 외부 CSS 파일과 함께 포함된 스타일 요소도 파싱한다. 스타일 정보와 HTML 표시 규칙은 “렌더 트리”라고 부르는 또 다른 트리를 생성한다.

렌더 트리는 색상 또는 면적과 같은 시각적 속성이 있는 사각형을 포함하고 있는데 정해진 순서대로 화면에 표시된다.

렌더 트리 생성이 끝나면 배치가 시작되는데 이것은 각 노드가 화면의 정확한 위치에 표시되는 것을 의미한다. 

![image](https://user-images.githubusercontent.com/30422982/40397485-052e0386-5e6e-11e8-960c-414f9ad65574.png)

파싱 일반
문서 파싱은 브라우저가 코드를 이해하고 사용할 수 있는 구조로 변환하는 것을 의미한다. 파싱 결과는 보통 문서 구조를 나타내는 노드 트리인데 파싱 트리(parse tree) 또는 문법(syntax tree)트리 라고 부른다.

HTML 파서
HTML 파서는 HTML마크업을 파싱 트리로 변환한다.

HTML 문법 정의
HTML의 어휘와 문법은 W3C에 의해 명세로 정의되어 있다. 

DOM 
“파싱 트리”는 DOM 요소와 속성 노드의 트리로서 출력 트리가 된다. DOM은 문서 객체 모델(Document Object Model)의 준말이다. 이것은 HTML 문서의 객체 표현이고 외부를 향하는 자바스크립트와 같은 HTML 요소의 연결 지점이다. 트리의 최상위 객체는 문서이다.

DOM은 마크업과 1:1 관계를 맺는다. 예를 들면 이런 마크업이 있다.
```html
<html>
  <body>
   <p>Hello World</p>
   <div><img src="example.png" /></div>
  </body>
</html>
```

이것은 아래와 같은 DOM 트리로 변환할 수 있다.

![image](https://user-images.githubusercontent.com/30422982/40397497-10fa8e46-5e6e-11e8-85ad-0fbbba0a962d.png)

파싱 알고리즘 - 토큰화
토큰화는 어휘 분석으로서 입력 값을 토큰으로 파싱한다.
HTML에서 토큰은 시작 태그, 종료 태그, 속성 이름과 속성 값이다.

토큰화는 토큰을 인지해서 트리 생성자로 넘기도 다른 토큰을 확인하기 위해 다음 문자를 확인한다. 그리고 입력의 마지막까지 이 과정을 반복한다.
![image](https://user-images.githubusercontent.com/30422982/40397525-29eda5c8-5e6e-11e8-9437-6334960f1524.png)
토큰화 알고리즘 
알고리즘의 결과물은 HTML토큰이다. 알고리즘은 상태 기계(State Machine)라고 볼 수 있다. 각 상태는 하나 이상의 연속된 문자를 입력받아 이 문자에 따라 다음 상태를 갱신한다. 그러나 결과는 현재의 토큰화 상태와 트리 구축 상태의 영향을 받는데, 이것은 같은 문자를 읽어 들여도 현재 상태에 따라 다음 상태의 결과가 다르게 나온다는 것을 의미한다.
알고리즘은 전체를 설명하기에 너무 복잡하니 원리 이해를 도울만한 간단한 예제를 한번 보자.
HTML 토큰화 기본 예제
```html
<html>
    <body>
        Hello world
    </body>
</html>
```
초기 상태는 “자료 상태” 이다. < 문자를 만나면 상태는 “태그 열림 상태”로 변한다. a 부터 z까지의 문자를 만나면 “시작 태그 토큰”을 생성하고 상태는 “태그 이름 상태” 로 변하는데 이 상태는 > 문자를 만날 때까지 유지 한다. 각 문자에는 새로운 토큰 이름이 붙는데 이 경우 생성된 토큰은 html 토큰이다.

>문자에 도달하면 현재 토큰이 발행되고 상태는 다시 “자료 상태”로 바뀐다. 태그는 동일한 절차에 따라 처리된다. 지금까지 html 태그와 body태그를 발행했고 다시 “자료 상태”로 돌아왔다. Hello World의 H문자를 만나면 문자 토큰이 생성되고 발행될 것이다. 이것은 종료 태그의 < 문자를 만날 때까지 진행된다. Hello World의 각 문자를 위한 문자 토큰을 발행할 것이다.

다시 “태그 열람 상태”가 되었다. / 문자는 종료 태그 토큰을 생성하고 “태그 이름 상태”로 변경 될 것이다. 이 상태는 > 문자를 만날 때까지 유지된다. 그리고 새로운 태그 토큰이 발행되고 다시 “자료 상태”가 된다. 또한 동일하게 처리 될 것이다.



웹킷 CSS 파서
![image](https://user-images.githubusercontent.com/30422982/40397678-c78555d8-5e6e-11e8-84fb-f9c127410d35.png)

